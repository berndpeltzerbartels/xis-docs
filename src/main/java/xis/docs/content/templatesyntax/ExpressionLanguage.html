<xis:template xmlns:xis="http://www.w3.org/1999/XSL/Transform">
    <h3>${chapterHeadline}</h3>
    <p>
        The XIS Expression Language (EL) enables dynamic expressions in templates through the <code>$​{...}</code> 
        syntax. It's JavaScript-like but safe and focused on template needs, with no access to browser APIs or 
        unsafe objects. Use EL for accessing data, calculations, string formatting, and conditional logic directly 
        in your HTML templates.
    </p>

    <h5>Basic Syntax</h5>
    <p>Expressions are enclosed in <code>$​{...}</code> and can appear in text content and attribute values:</p>
    <ul>
        <li><b>Variable access:</b> <code>$​{user.name}</code>, <code>$​{item.price}</code></li>
        <li><b>Function calls:</b> <code>$​{toUpperCase(user.name)}</code>, <code>$​{formatDate(order.date, 'en-US')}</code></li>
        <li><b>Operators:</b> <code>$​{a + b}</code>, <code>$​{count > 0 ? 'found' : 'none'}</code></li>
        <li><b>Array/Object access:</b> <code>$​{items[0]}</code>, <code>$​{order['status']}</code></li>
    </ul>

    <h5>Operators</h5>
    <p>EL supports standard operators for calculations and comparisons:</p>
    <ul>
        <li><b>Arithmetic:</b> <code>+</code> (addition), <code>-</code> (subtraction), <code>*</code> (multiplication), 
            <code>/</code> (division), <code>%</code> (modulo)</li>
        <li><b>Comparison:</b> <code>==</code> (equals), <code>!=</code> (not equals), <code>&gt;</code> (greater), 
            <code>&gt;=</code> (greater or equal), <code>&lt;</code> (less), <code>&lt;=</code> (less or equal)</li>
        <li><b>Logical:</b> <code>&amp;&amp;</code> (and), <code>||</code> (or), <code>!</code> (not)</li>
        <li><b>Ternary:</b> <code>condition ? valueIfTrue : valueIfFalse</code></li>
        <li><b>Array/Object Access:</b> <code>arr[0]</code>, <code>obj['key']</code>, <code>obj.property</code></li>
    </ul>

    <h5>Built-in Functions</h5>
    
    <h6>String Functions</h6>
    <ul>
        <li><code>toUpperCase(str)</code> - Converts to uppercase</li>
        <li><code>toLowerCase(str)</code> - Converts to lowercase</li>
        <li><code>substring(str, start, end)</code> - Extracts substring</li>
        <li><code>replace(str, search, replace)</code> - Replaces text</li>
        <li><code>trim(str)</code> - Removes whitespace from both ends</li>
        <li><code>split(str, separator)</code> - Splits string into array</li>
        <li><code>join(array, separator)</code> - Joins array into string</li>
    </ul>

    <h6>Array & Object Functions</h6>
    <ul>
        <li><code>length(obj)</code> - Returns length/size of array or object</li>
        <li><code>size(obj)</code> - Alias for <code>length()</code></li>
        <li><code>count(obj)</code> - Alias for <code>length()</code></li>
        <li><code>empty(obj)</code> - Returns true if empty/null/undefined</li>
        <li><code>notEmpty(obj)</code> - Returns true if not empty (opposite of <code>empty()</code>)</li>
        <li><code>keys(obj)</code> - Returns array of object keys</li>
        <li><code>values(obj)</code> - Returns array of object values</li>
        <li><code>hasKey(obj, key)</code> - Checks if object has key</li>
        <li><code>contains(array, value)</code> - Checks if array contains value</li>
    </ul>

    <h6>Number Functions</h6>
    <ul>
        <li><code>round(value, digits)</code> - Rounds to specified decimals</li>
        <li><code>floor(value)</code> - Rounds down to integer</li>
        <li><code>ceil(value)</code> - Rounds up to integer</li>
        <li><code>abs(value)</code> - Returns absolute value</li>
    </ul>

    <h6>Date & Time Functions</h6>
    <ul>
        <li><code>formatDate(date, locale)</code> - Formats date (e.g., '12/31/2024')</li>
        <li><code>formatDateTime(date, locale)</code> - Formats date and time</li>
        <li><code>formatTime(date, locale)</code> - Formats time only</li>
        <li><code>year(date)</code>, <code>month(date)</code>, <code>day(date)</code> - Extract components</li>
        <li><code>hour(date)</code>, <code>minute(date)</code> - Extract time components</li>
    </ul>

    <h6>Utility Functions</h6>
    <ul>
        <li><code>default(value, fallback)</code> - Returns value or fallback if null/undefined</li>
    </ul>

    <h5>Variables & Scoping</h5>
    <p>Different types of variables are available in templates:</p>
    <ul>
        <li><b>Model Data:</b> All data provided by controller <code>@ModelData</code> methods is directly accessible 
            (<code>$​{user}</code>, <code>$​{orderList}</code>)</li>
        <li><b>Loop Variables:</b> Variables defined by <code>xis:foreach</code> are available within the loop scope</li>
        <li><b>Action Parameters:</b> Values passed via <code>&lt;xis:parameter&gt;</code> tags</li>
        <li><b>Storage Variables:</b> <code>$​{localStorage.theme}</code>, <code>$​{sessionStorage.tab}</code> 
            for client-side storage</li>
        <li><b>Variable Shadowing:</b> Inner scopes can shadow outer variables with the same name</li>
    </ul>

    <h5>Practical Examples</h5>

    <p><strong>String Formatting:</strong></p>
    <pre><code>&lt;div&gt;Hello $​{toUpperCase(user.name)}!&lt;/div&gt;
&lt;p&gt;Email: $​{toLowerCase(user.email)}&lt;/p&gt;</code></pre>

    <p><strong>Conditional Display:</strong></p>
    <pre><code>&lt;span&gt;$​{count > 0 ? count + ' items found' : 'No results'}&lt;/span&gt;
&lt;div class="$​{user.isActive ? 'active' : 'inactive'}"&gt;Status&lt;/div&gt;</code></pre>

    <p><strong>Calculations:</strong></p>
    <pre><code>&lt;div&gt;Total: $​{quantity * price}&lt;/div&gt;
&lt;div&gt;Discount: $​{round(price * 0.15, 2)}&lt;/div&gt;</code></pre>

    <p><strong>Date Formatting:</strong></p>
    <pre><code>&lt;div xis:foreach="order:$​{orders}"&gt;
    &lt;div&gt;Order #$​{order.id} - $​{formatDate(order.date, 'en-US')}&lt;/div&gt;
&lt;/div&gt;</code></pre>

    <p><strong>Default Values:</strong></p>
    <pre><code>&lt;div&gt;$​{default(user.email, 'No email provided')}&lt;/div&gt;
&lt;span&gt;$​{default(user.phone, 'N/A')}&lt;/span&gt;</code></pre>

    <p><strong>Complex Expressions:</strong></p>
    <pre><code>&lt;div xis:if="$​{notEmpty(items) &amp;&amp; user.hasPermission}"&gt;
    Found $​{length(items)} items for $​{user.name}
&lt;/div&gt;</code></pre>

    <h5>Safety & Best Practices</h5>
    <ul>
        <li><b>Safe Evaluation:</b> All expressions are evaluated in a secure sandbox with no access to 
            <code>window</code>, <code>document</code>, or other browser APIs</li>
        <li><b>Function Nesting:</b> Functions can be nested arbitrarily: <code>$​{toUpperCase(trim(user.name))}</code></li>
        <li><b>Date Flexibility:</b> Date functions accept Date objects, ISO strings, or timestamps</li>
        <li><b>Keep It Simple:</b> For complex logic, move calculations to controller <code>@ModelData</code> methods 
            rather than embedding in templates</li>
        <li><b>Custom Functions:</b> You can add project-specific utility functions to extend the EL capabilities</li>
        <li><b>Error Handling:</b> Invalid expressions fail safely without breaking the page</li>
    </ul>

    <h5>Advanced Usage</h5>
    <p>Expressions can be combined with framework attributes for powerful dynamic behavior:</p>
    <pre><code>&lt;div xis:if="$​{users.size() > 0}"&gt;
    &lt;div xis:foreach="user:$​{users}" 
         xis:if="$​{user.isActive &amp;&amp; user.age >= 18}"&gt;
        &lt;h3&gt;$​{user.name} ($​{user.age} years old)&lt;/h3&gt;
        &lt;p class="$​{user.isPremium ? 'premium' : 'standard'}"&gt;
            Member since $​{formatDate(user.joinDate, 'en-US')}
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>

</xis:template>