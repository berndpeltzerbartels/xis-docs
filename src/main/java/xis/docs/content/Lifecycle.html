<xis:template xmlns:xis="http://www.w3.org/1999/XSL/Transform">
    <h3>${chapterHeadline}</h3>
    <p>Understanding the XIS request lifecycle helps you write effective controllers. This chapter explains how
        requests flow through the framework, when controller methods are executed, and how responses are generated.</p>

    <h5>Request Flow Overview</h5>
    <p>Every user interaction in XIS follows a predictable flow:</p>
    <xis:raw>
        <ol>
            <li><strong>User Action:</strong> User clicks a link, submits a form, or triggers an action</li>
            <li><strong>Request Processing:</strong> XIS routes the request to the appropriate controller</li>
            <li><strong>Parameter Binding:</strong> URL parameters, form data, and action parameters are bound to
                controller fields
            </li>
            <li><strong>Action Execution:</strong> <code>@Action</code> methods are called (if triggered)</li>
            <li><strong>Navigation Decision:</strong> Framework determines the target page or widget based on action
                return value
            </li>
            <li><strong>Data Loading:</strong> <code>@ModelData</code> methods are executed to load data for the
                template
            </li>
            <li><strong>Template Rendering:</strong> HTML template is rendered with the model data</li>
            <li><strong>Response:</strong> Rendered HTML is sent to the browser and displayed</li>
        </ol>
    </xis:raw>

    <h5>Initial Page Load</h5>
    <p>When a page is first loaded (e.g., user navigates to <code>/products.html</code>):</p>
    <xis:raw>
        <ol>
            <li>XIS identifies the <code>@Page</code> controller matching the URL</li>
            <li><code>@PathVariable</code> and <code>@QueryParameter</code> values are injected</li>
            <li>All <code>@ModelData</code> methods are executed to prepare template data</li>
            <li>The HTML template is rendered with the model data</li>
            <li>The complete page is sent to the browser</li>
        </ol>
    </xis:raw>

    <h5>Action Execution Phase</h5>
    <p>When a user triggers an action (button click, link action, form submission):</p>
    <xis:raw>
        <ol>
            <li>The corresponding <code>@Action</code> method is invoked</li>
            <li><code>@ActionParameter</code> values from the template are injected</li>
            <li><code>@FormData</code> is bound if the action was triggered by a form submission</li>
            <li>The action method executes business logic (save, update, delete, etc.)</li>
            <li>The action returns a navigation target (page class, widget response, or void)</li>
        </ol>
    </xis:raw>

    <h5>ModelData Phase</h5>
    <p>After determining the target page or widget, XIS loads the data:</p>
    <xis:raw>
        <ol>
            <li>All <code>@ModelData</code> methods in the target controller are executed</li>
            <li>Return values become template variables (method name = variable name)</li>
            <li>Methods are called in declaration order within the class</li>
            <li><code>@RequestScope</code> data is shared between methods in the same request</li>
        </ol>
        <pre><code>@ModelData
User currentUser() {
    return userService.findById(userId); // Executed during ModelData phase
}

@ModelData
List&lt;Order&gt; orders() {
    return orderService.findByUser(currentUser()); // Can call other @ModelData methods
}</code></pre>
    </xis:raw>

    <h5>Navigation and Response</h5>
    <p>The navigation target determines what gets rendered:</p>
    <xis:raw>
        <ul>
            <li><strong>void or null:</strong> Current page/widget is refreshed with updated data</li>
            <li><strong>Class&lt;?&gt;:</strong> Navigate to the specified page, full page reload</li>
            <li><strong>WidgetResponse:</strong> Load a different widget in the same container, only widget area updates
            </li>
            <li><strong>PageResponse:</strong> Navigate to a page with specific URL parameters</li>
        </ul>
        <pre><code>@Action
Class&lt;?&gt; deleteItem() {
    itemService.delete(itemId);
    return ItemListPage.class; // Navigate to list page
}

@Action
void updateItem() {
    itemService.update(item);
    // void = stay on current page, refresh data
}</code></pre>
    </xis:raw>

    <h5>Update Events and Refresh</h5>
    <p>XIS enables reactive updates through an event system that allows widgets to notify each other of changes:</p>
    <xis:raw>
        <pre><code>// Widget that emits an event
@Action(value = "addToCart", updateEventKeys = {"cart-updated"})
void addToCart(@ActionParameter("productId") String productId) {
    cartService.addProduct(productId);
    // After action completes, "cart-updated" event is broadcast
}

// Widget that listens for the event
@Widget
@RefreshOnUpdateEvents("cart-updated")
class CartSummaryWidget {
    @ModelData
    int itemCount() {
        return cartService.getItemCount();
        // This method is called again when "cart-updated" fires
    }
}</code></pre>
        <p>When an action emits an update event, all widgets annotated with <code>@RefreshOnUpdateEvents</code>
            listening for that event key will automatically refresh their <code>@ModelData</code> and re-render
            their templates.</p>
        <p>See the <a href="#" xis:page="WidgetUpdateEvents">Update Events</a> chapter for detailed examples
            including shopping carts, notifications, and multi-widget synchronization patterns.</p>
    </xis:raw>

    <h5>Optimization: Lazy Loading</h5>
    <p>Only components visible on screen execute their <code>@ModelData</code> methods. Widgets inside
        <code>&lt;xis:widget-container&gt;</code> that haven't been loaded yet don't execute until they're
        actually displayed.</p>
</xis:template>
