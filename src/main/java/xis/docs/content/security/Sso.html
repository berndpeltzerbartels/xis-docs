<xis:template xmlns:xis="http://www.w3.org/1999/XSL/Transform">
    <h3>${chapterHeadline}</h3>

    <p>
        The <code>xis-idp-server</code> module turns your XIS application into a full-fledged Identity Provider (IDP).
        Other applications can then authenticate against your XIS app.
    </p>

    <h4>Gradle Dependencies</h4>
    <pre><code>dependencies {
    implementation 'one.xis:xis-authentication'  // For token creation
    implementation 'one.xis:xis-idp-server'      // IDP functionality
}</code></pre>

    <h4>How It Works</h4>
    <p>
        <code>xis-idp-server</code> provides complete IDP logic:
    </p>

    <ul>
        <li>OpenID Connect / OAuth2 endpoints</li>
        <li>Authorization Code Flow with PKCE</li>
        <li>Token issuance (Access Token, Refresh Token, ID Token)</li>
        <li>Well-Known Configuration endpoint</li>
        <li>Public Key endpoint for token validation</li>
    </ul>

    <p>
        You only need to implement an interface that provides user data.
    </p>

    <h4>Implementing IDPService Interface</h4>
    <p>
        The framework needs access to your user data. Implement the <code>IDPService</code> interface:
    </p>

    <pre><code>@Component
public class MyIDPService implements IDPService {
    
    private final UserRepository userRepository;
    
    @Override
    public UserInfo authenticate(String username, String password) {
        User user = userRepository.findByUsername(username);
        
        if (user == null || !passwordMatches(password, user)) {
            return null; // Login failed
        }
        
        // Return UserInfo with roles
        return new UserInfoImpl(
            user.getId(),
            Arrays.asList(user.getRoles())
        );
    }
    
    @Override
    public UserInfo getUserInfo(String userId) {
        User user = userRepository.findById(userId);
        return new UserInfoImpl(
            user.getId(),
            Arrays.asList(user.getRoles())
        );
    }
}</code></pre>

    <h4>Registering Client Applications</h4>
    <p>
        Other applications that want to authenticate with your IDP must be registered:
    </p>

    <pre><code>@Component
public class MyIDPClientConfig implements IDPClientConfig {
    
    @Override
    public String getClientId() {
        return "my-app";
    }
    
    @Override
    public String getClientSecret() {
        return "secret123"; // In production: Use secure storage!
    }
    
    @Override
    public String getRedirectUri() {
        return "https://app.example.com/auth/callback";
    }
}</code></pre>

    <h4>IDP Endpoints</h4>
    <p>
        The module automatically provides these endpoints:
    </p>

    <ul>
        <li><code>/.well-known/openid-configuration</code> - OpenID Connect Discovery</li>
        <li><code>/oauth2/authorize</code> - Authorization Endpoint</li>
        <li><code>/oauth2/token</code> - Token Endpoint</li>
        <li><code>/oauth2/keys</code> - Public Keys (JWKS)</li>
        <li><code>/oauth2/userinfo</code> - User Info Endpoint</li>
    </ul>

    <h4>Configuring Client Application</h4>
    <p>
        Other XIS applications connect using <code>xis-idp-client</code>:
    </p>

    <pre><code>// In the client application
dependencies {
    implementation 'one.xis:xis-idp-client'
}

@Component
public class MyExternalIDPConfig implements ExternalIDPConfig {
    
    @Override
    public String getIdpId() {
        return "my-xis-idp";
    }
    
    @Override
    public String getIdpServerUrl() {
        return "https://idp.example.com";
    }
    
    @Override
    public String getClientId() {
        return "my-app";
    }
    
    @Override
    public String getClientSecret() {
        return "secret123";
    }
}</code></pre>

    <h4>Use Case</h4>
    <p>
        Use <code>xis-idp-server</code> when:
    </p>

    <ul>
        <li>You have multiple XIS applications that should share a single login (SSO)</li>
        <li>You have your own user management (don't want to replace with Keycloak/Google)</li>
        <li>You need custom business logic in the login flow</li>
        <li>You want to use XIS as IDP for legacy applications</li>
    </ul>
    Con

</xis:template>