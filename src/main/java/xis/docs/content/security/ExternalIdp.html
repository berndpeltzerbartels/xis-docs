<xis:template xmlns:xis="http://www.w3.org/1999/XSL/Transform">
    <h3>${chapterHeadline}</h3>

    <div class="warning-box">
        <strong>Work in Progress:</strong> Integration of external Identity Providers (Keycloak, Google, etc.)
        is under development. The infrastructure is in place, specific provider integrations coming soon.
    </div>

    <p>
        XIS supports authentication via external Identity Providers using OpenID Connect and OAuth2.
        The <code>xis-idp-client</code> module implements the complete Authorization Code Flow with PKCE.
    </p>

    <h4>Gradle Dependency</h4>
    <pre><code>dependencies {
    implementation 'one.xis:xis-idp-client'
}</code></pre>

    <h4>Architecture</h4>
    <p>
        The IDP client implementation is generic and works with all OpenID Connect-compatible providers:
    </p>

    <ul>
        <li>Automatic discovery via <code>/.well-known/openid-configuration</code></li>
        <li>Authorization Code Flow with PKCE</li>
        <li>Token exchange and refresh</li>
        <li>JWT validation with public keys (JWKS)</li>
        <li>Full OAuth2 compliance</li>
    </ul>

    <h4>Keycloak Integration (Planned)</h4>
    <p>
        Keycloak is an open-source Identity Provider. Integration requires only configuration:
    </p>

    <pre><code>@Component
public class KeycloakConfig implements ExternalIDPConfig {
    
    @Override
    public String getIdpId() {
        return "keycloak";
    }
    
    @Override
    public String getIdpServerUrl() {
        // Keycloak Realm URL
        return "https://keycloak.example.com/realms/myrealm";
    }
    
    @Override
    public String getClientId() {
        return "xis-application";
    }
    
    @Override
    public String getClientSecret() {
        return System.getenv("KEYCLOAK_CLIENT_SECRET");
    }
}</code></pre>

    <p>
        The framework automatically handles:
    </p>
    <ul>
        <li>Redirect to Keycloak login</li>
        <li>Token processing after callback</li>
        <li>Role extraction from JWT claims</li>
        <li>Token refresh on expiration</li>
    </ul>

    <h4>Google Authentication (Planned)</h4>
    <p>
        Use Google as IDP for "Login with Google":
    </p>

    <pre><code>@Component
public class GoogleConfig implements ExternalIDPConfig {
    
    @Override
    public String getIdpId() {
        return "google";
    }
    
    @Override
    public String getIdpServerUrl() {
        return "https://accounts.google.com";
    }
    
    @Override
    public String getClientId() {
        // From Google Cloud Console
        return "123456789-abc.apps.googleusercontent.com";
    }
    
    @Override
    public String getClientSecret() {
        return System.getenv("GOOGLE_CLIENT_SECRET");
    }
}</code></pre>

    <h4>Single Sign-On (SSO)</h4>
    <p>
        With external IDPs, Single Sign-On is automatically supported:
    </p>

    <ul>
        <li>User logs in once with the IDP (e.g., Keycloak)</li>
        <li>All XIS applications using the same IDP recognize the session</li>
        <li>No re-login when switching between applications</li>
        <li>Centralized logout possible</li>
    </ul>

    <h4>Multiple IDPs Simultaneously</h4>
    <p>
        You can configure multiple Identity Providers in parallel:
    </p>

    <pre><code>@Component
public class KeycloakConfig implements ExternalIDPConfig {
    public String getIdpId() { return "keycloak"; }
    // ... Keycloak configuration
}

@Component
public class GoogleConfig implements ExternalIDPConfig {
    public String getIdpId() { return "google"; }
    // ... Google configuration
}</code></pre>

    <p>
        Users can then choose at login:
    </p>

    <pre><code>&lt;a href="/auth/keycloak/login"&gt;Sign in with Keycloak&lt;/a&gt;
&lt;a href="/auth/google/login"&gt;Sign in with Google&lt;/a&gt;</code></pre>

    <h4>Distributed Applications & SSO</h4>
    <p>
        External IDPs become especially important for distributed XIS applications:
    </p>

    <ul>
        <li>Centralized authentication for multiple microservices</li>
        <li>Session sharing between different XIS instances</li>
        <li>Unified role management across application boundaries</li>
    </ul>

    <div class="info-box">
        <strong>Technical Status:</strong> The OpenID Connect / OAuth2 infrastructure is fully implemented
        (<code>xis-idp-client</code> module). Provider-specific configuration classes and documentation coming soon.
        Integration already works now with any OpenID Connect-compatible provider by implementing
        the <code>ExternalIDPConfig</code> interface.
    </div>

    <div class="info-box">
        <strong>Alternative:</strong> For simple applications without external dependencies, see
        <em>XIS Authentication</em> (local tokens) or <em>XIS as IDP</em> (own IDP server).
    </div>

</xis:template>